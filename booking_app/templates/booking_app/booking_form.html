<!-- booking_app/templates/booking_app/booking_form.html -->
{% extends 'booking_app/base.html' %}
{% load static %}

{% block title %}Book Conference - Conference Booking{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'conferences' %}">Conferences</a></li>
        <li class="breadcrumb-item"><a href="{% url 'conference_detail' conference.slug %}">{{ conference.topic }}</a></li>
        <li class="breadcrumb-item active">Book</li>
    </ol>
</nav>

<div class="card">
    <div class="card-header bg-primary text-white">
        <h3 class="card-title mb-0">Confirm Booking</h3>
    </div>
    <div class="card-body">
        <div class="mb-4">
            <h4>Conference Details</h4>
            <dl class="row">
                <dt class="col-sm-3">Topic:</dt>
                <dd class="col-sm-9">{{ conference.topic }}</dd>
                
                <dt class="col-sm-3">Time:</dt>
                <dd class="col-sm-9">{{ conference.time_start|time:"g:i A" }} - {{ conference.time_end|time:"g:i A" }}</dd>
                
                <dt class="col-sm-3">Speakers:</dt>
                <dd class="col-sm-9">
                    {% for speaker in conference.speakers.all %}
                    {{ speaker.first_name }} {{ speaker.last_name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </dd>
                
                <dt class="col-sm-3">Price:</dt>
                <dd class="col-sm-9">${{ conference.price }}</dd>
            </dl>
        </div>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            Please confirm your booking for this conference. Once booked, you can cancel it anytime from your bookings page.
        </div>
        
        <form method="post" id="booking-form">
            {% csrf_token %}
            {{ form.conference }}
            
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Payment Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="id_payment_method" class="form-label">Payment Method</label>
                        {{ payment_form.payment_method }}
                    </div>
                    
                    <div id="credit-card-fields" class="payment-fields">
                        <div class="mb-3">
                            <label for="id_card_number" class="form-label">Card Number</label>
                            {{ payment_form.card_number }}
                        </div>
                        <div class="mb-3">
                            <label for="id_card_holder" class="form-label">Card Holder Name</label>
                            {{ payment_form.card_holder }}
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="id_expiry_date" class="form-label">Expiry Date</label>
                                {{ payment_form.expiry_date }}
                                <div class="form-text">{{ payment_form.expiry_date.help_text }}</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="id_cvv" class="form-label">CVV</label>
                                {{ payment_form.cvv }}
                            </div>
                        </div>
                    </div>
                    
                    <div id="paypal-fields" class="payment-fields d-none">
                        <div class="alert alert-info">
                            <i class="fab fa-paypal me-2"></i>
                            You will be redirected to PayPal to complete your payment.
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="{% url 'conference_detail' conference.slug %}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-success">Confirm Booking & Pay</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const paymentMethodSelect = document.getElementById('id_payment_method');
        const creditCardFields = document.getElementById('credit-card-fields');
        const paypalFields = document.getElementById('paypal-fields');
        
        function togglePaymentFields() {
            if (paymentMethodSelect.value === 'paypal') {
                creditCardFields.classList.add('d-none');
                paypalFields.classList.remove('d-none');
            } else {
                creditCardFields.classList.remove('d-none');
                paypalFields.classList.add('d-none');
            }
        }
        
        paymentMethodSelect.addEventListener('change', togglePaymentFields);
        togglePaymentFields(); // Initial state
    });
</script>
{% endblock %} 